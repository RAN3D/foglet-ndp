<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>1 Client tests</title>
    <script type='text/javascript' src='../node_modules/jquery/dist/jquery.min.js'> </script>
    <script type='text/javascript' src='../build/foglet-ndp.bundle.js' > </script>
  </head>

  <script type='text/javascript'>
    localStorage.debug = 'foglet-ladda';

    const NDP = require('foglet-ndp').NDP;
    let endpoint = 'https://query.wikidata.org/bigdata/ldf';
    //endpoint = 'http://172.16.9.3:6000/dbpedia_3_8';
    //endpoint = 'http://curiosiphi.lina.sciences.univ-nantes.prive/dbpedia_3_8';
    //endpoint = 'http://fragments.dbpedia.org/';
    //endpoint = 'http://52.39.116.115/watDiv_100';
    let request = [
      'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } LIMIT 10',
  		'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 10 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 20 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 30 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 40 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 50 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 60 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 70 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 80 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 90 LIMIT 10'
    ];



    let f1,f2,f3;

    let verbose = true;

    f1 = new NDP({
      protocol: 'testNdp',
      webrtc:	{
        trickle: true,
        iceServers : []
      },
      room: 'test',
      signalingAdress: 'http://localhost:3000',
      verbose: verbose
    });

    f1.init();

    f1.connection().then(() => {
      console.log('Client connected');
    });

    function connection(){
      f1.connection().then(() => {
        console.log('Client connected');
      });
    }

    function workload(){
      f1.delegationProtocol.timeout = 10*1000;
      f1.delegationProtocol.nbDestinations = 2;
      let a = 0, i = 0;
      let list = [];
      for(i = 0; i<1; ++i) list.push(i);

      list.reduce(elem => elem.then((results) => {
        a++;
        console.log('Results: '+a, results);
        return f1.delegationProtocol.sendPromise(request, endpoint, false);
      }), Promise.resolve(undefined));
    }
  </script>

  <body>
    <h3> Please see your console (F12) to see logs of the example </h3>
    <h3> You have to run a signaling server in order to run this example, cause it was made for multiple clients in several tabs or window browsers </h3>
    <p> If an error appeared with jquery, it's because you did not clone the repository from github, you just installed the package with npm.
      <br/> JQuery is not in the dependencies installed.</p>

    <button onclick="connection()"> Connection </button> <button onclick="workload()"> Load the workload ! </button>

  </body>

</html>
