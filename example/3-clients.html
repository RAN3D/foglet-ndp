<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>3 Clients tests</title>
    <script type='text/javascript' src='../node_modules/jquery/dist/jquery.min.js'> </script>
    <script type='text/javascript' src='../build/foglet-ndp.bundle.js' > </script>
  </head>

  <script type='text/javascript'>
    localStorage.debug = 'foglet-ladda';

    const NDP = require('foglet-ndp').NDP;
    let endpoint = 'https://query.wikidata.org/bigdata/ldf';
    let request = [
      'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } LIMIT 10',
  		'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 10 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 20 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 30 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 40 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 50 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 60 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 70 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 80 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 90 LIMIT 10'
    ];



    let f1,f2,f3;


    f1 = new NDP({
      protocol: 'testNdp',
      webrtc:	{
        trickle: true,
        iceServers : []
      },
      room: 'test',
      verbose: true
    });
    f2 = new NDP({
      protocol: 'testNdp',
      webrtc:	{
        trickle: true,
        iceServers : []
      },
      room: 'test',
      verbose: true
    });

    f3 = new NDP({
      protocol: 'testNdp',
      webrtc:	{
        trickle: true,
        iceServers : []
      },
      room: 'test',
      verbose: true
    });

    f1.init();
    f2.init();
    f3.init();

    f1.connection(f2).then(() => {
      f1.connection(f3).then(() => {
        f3.connection(f1).then( () => {
          f2.connection(f1).then( () => {
            console.log('All clients connected between them.')
            f1.delegationProtocol.sendPromise(request, endpoint, false).then( (results) => {
              console.log(results);
            }).catch(error => console.log(error));
          });
        });
      });
    });

    f1.onUnicast((id, message) => console.log);
    f2.onUnicast((id, message) => console.log);
    f3.onUnicast((id, message) => console.log);
  </script>

  <body>
    <h3> Please see your console (F12) to see logs of the example </h3>
    <p> If an error appeared with jquery, it's because you did not clone the repository from github, you just installed the package with npm.
      <br/> JQuery is not in the dependencies installed.</p>
  </body>

</html>
