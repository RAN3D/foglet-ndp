<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>2 Clients tests</title>
    <script type='text/javascript' src='../node_modules/jquery/dist/jquery.min.js'> </script>
    <script type='text/javascript' src='../node_modules/spray-wrtc/build/spray-wrtc.bundle.js'> </script>
    <script type='text/javascript' src='../build/foglet-ndp.bundle.js' > </script>
  </head>

  <script type='text/javascript'>
    const Spray = require('spray-wrtc');
    const NDP = require('foglet-ndp').NDP;
    const endpoint = 'https://query.wikidata.org/bigdata/ldf';
    const request = [
      'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } LIMIT 10',
			'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 10 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 20 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 30 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 40 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 50 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 60 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 70 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 80 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 90 LIMIT 10'
    ];
    let f1,f2,f3;

    $.ajax({
      url : "https://service.xirsys.com/ice",
      data : {
        ident: "folkvir",
        secret: "a0fe3e18-c9da-11e6-8f98-9ac41bd47f24",
        domain: "foglet-examples.herokuapp.com",
        application: "foglet-examples",
        room: "test",
        secure: 1
      }}).then(function(response, status){
        console.log(status);
        console.log(response);
        /**
         * Create the foglet protocol.
         * @param {[type]} {protocol:"chat"} [description]
         */
        var iceServers = [];
        if(response.d.iceServers){
          iceServers = response.d.iceServers;
        }

        f1 = new NDP({
          spray: new Spray({
            protocol: 'testNdp',
            webrtc:	{
              trickle: true,
              iceServers
            }
          }),
          room: 'test'
        });
        f2 = new NDP({
          spray: new Spray({
            protocol: 'testNdp',
            webrtc:	{
              trickle: true,
              iceServers
            }
          }),
          room: 'test'
        });

        f3 = new NDP({
          spray: new Spray({
            protocol: 'testNdp',
            webrtc:	{
              trickle: true,
              iceServers
            }
          }),
          room: 'test'
        });

        f1.init();
        f2.init();
        let cpt = 0;
        f1.events.on('ndp-answer', (response) => {
          console.log(response)
          cpt++;
          console.log('Number of answer : ' + cpt);
        });

        f1.connection().then(status =>  {
          f3.init();
          return f3.connection();
        }).then( () => {
          f1.send(request, endpoint);
        });
    });
  </script>

  <body>
    <h3> Please see your console (F12) to see logs of the example </h3>
    <p> If an error appeared with jquery, it's because you did not clone the repository from github, you just installed the package with npm.
      <br/> JQuery is not in the dependencies installed.</p>
  </body>

</html>
