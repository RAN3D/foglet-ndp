<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>2 Clients tests</title>
    <script type='text/javascript' src='../node_modules/jquery/dist/jquery.min.js'> </script>
    <script type='text/javascript' src='../node_modules/spray-wrtc/build/spray-wrtc.bundle.js'> </script>
    <script type='text/javascript' src='../build/foglet-ndp.bundle.js' > </script>
  </head>

  <script type='text/javascript'>
    const NDP = require('foglet-ndp').NDP;
    const endpoint = 'https://query.wikidata.org/bigdata/ldf';
    const request = [
      'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } LIMIT 10',
  		'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 10 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 20 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 30 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 40 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 50 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 60 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 70 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 80 LIMIT 10',
    	'PREFIX wd: <http://www.wikidata.org/entity/> SELECT * WHERE { ?s ?p wd:Q142. ?s ?p ?o . } OFFSET 90 LIMIT 10'
    ];
    let f1,f2,f3;


    f1 = new NDP({
      protocol: 'testNdp',
      webrtc:	{
        trickle: false,
        iceServers : []
      },
      room: 'test'
    });
    f2 = new NDP({
      protocol: 'testNdp',
      webrtc:	{
        trickle: false,
        iceServers : []
      },
      room: 'test'
    });

    f3 = new NDP({
      protocol: 'testNdp',
      webrtc:	{
        trickle: false,
        iceServers : []
      },
      room: 'test'
    });

    f1.init();

    let cpt = 0;
    f1.events.on('ndp-answer', (response) => {
      console.log(response)
      cpt++;
      console.log('Number of answer : ' + cpt);
    });

    const directConnection = () => {
      f2.init();
      f2.connection(f1).then(status =>  {
        f3.init();
        return f3.connection(f1);
      }).then( () => {
        f1.send(request, endpoint);
      });
    };

    const signalingConnection = () => {
      f1.connection().then(status =>  {
        f2.init();
        f2.connection().then( () => {
          f3.init();
          f3.connection().then( () => {
            f1.send(request, endpoint);
          });
        });
      })
    };
  </script>

  <body>
    <h3> Please see your console (F12) to see logs of the example </h3>
    <p> If an error appeared with jquery, it's because you did not clone the repository from github, you just installed the package with npm.
      <br/> JQuery is not in the dependencies installed.</p>
  </body>

</html>
